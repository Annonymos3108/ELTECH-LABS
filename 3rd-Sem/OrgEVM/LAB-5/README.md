# Использование аппаратных прерываний, прерывание таймера

## Задание на лабораторную работу

1. Разработать, написать и отладить программу подключения собственной подпрограммы обработки прерывания и использовать её в цепочке со стандартной подпрограммой обработки прерывания от системнного таймера компьютера.
2. Заменить вектор прерывания системного таймера своей реализацией в котором будет генерироваться сигнал SOS с простоями в одну секунду, короткие сигналы 1 секунда, длинные – 2 секунды. Для звука использовать системный динамик.
3. Отлаженныую программу предъявить преподавателю.

### Краткие сведения об используемых прерываниях

Микропроцессоры 8086/88 поддерживают механизм прерываний. В самом общем виде это наличие в аппаратуре специальных средств, с помощью которых выполнение текущей программы приостанавливается и процессор переходит к так называемой программе обслуживания прерывания (Interrupt Servise Routine - ISR). Механизм прерываний позволяет организовать выполнение тех или иных функций ядра и быструю реакцию процессора на возникновение каких-то внешних событий: ошибок в арифметических операциях, изменению состояния периферийных устройств и пр.
Микропроцессоры 8086/88 поддерживают 256 прерываний. Каждое из них имеет свой номер и ISR. Адрес точки входа в ISR называется вектором прерывания и хранится в специальной таблице, называемой таблицей векторов прерывания (ТВП). Код ISR может располагаться в любом месте памяти. Поэтому вектор прерывания занимает 4 байта: 2 байта отводится на значение сегментного регистра, устанавливаемое в CS (старшее слово), 2 байта - на значение смещения, устанавливаемое в IP (младшее слово). Вся ТВП занимает 256 * 4 = 1024 байт и располагается в оперативной памяти, начиная с адреса 0000:0000.
При возникновении прерывания процессор помешает в стек 6 байт: текущее значение CS, текущее значение IP (пара этих регистров определяет точку, с которой выполнение прерываемой программы возобновится), а также 2 байта флагов процессора. В CS и IP устанавливаются значения из ТВП, которые задают адрес начала ISR. Прерыванию 0 соответствует вектор прерывания по адресу 0000:0000, прерыванию 1 - по адресу 0000:0004h, прерыванию 2 - по адресу 0000:0008h и т.д.
Сама ISR - это программа, построенная с соблюдением специальных правил:

1) В самом начале она сохраняет в стеке все регистры процессора, которые будут использоваться в этой программе;
2) Перед завершением работы программы значения регистров восстанавли-ваются;
3) Последней инструкцией ISR, как правило, является инструкция возврата из прерывания IRET. Выполняя IRET, процессор извлекает из стека шесть слов информации, которые последовательно помещает в регистры IP, CS и регистр флагов, возвращаясь к исполнению прерванной программы.
Часто обработчикам программных прерываний требуется передать какие-то значения, задающие конкретное действие, характеристики ситуации и т.п., и получить какие-то результаты по завершению исполнения ISR. Для такого обмена данными используются внутренние регистры процессора.
Некоторые векторы прерывания в ТВП на самом деле задают не точки входа в ISR, а используются для хранения важной системной информации: адресов данных и таблиц. Кроме того, за некоторые векторы "зацеплены" ISR, не выполняющие никаких действий. Они служат заглушками для подключения дополнительных обработчиков. Так, например, в нормальном состоянии обработчик прерывания 1Ch не выполняет никаких действий и содержит единственную инструкцию возврата из прерывания IRET. Прерывание 1Ch вызывается из пределов ISR таймера (обработчик прерывания 8). Прерывание от таймера, в свою очередь, генерируется 18.2 раза в секунду аппаратурой системного таймера. Есть и другие обработчики - заглушки, вызываемые при функционировании ISR BIOS и MS-DOS.
